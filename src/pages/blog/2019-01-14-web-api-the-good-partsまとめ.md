---
templateKey: blog-post
title: Web API The Good Partsまとめ
date: 2019-01-14T05:26:02.596Z
description: Web API The Good Partsまとめ
tags:
  - API
---
タイトルのとおり、「Web API The Good Parts」を読んでのまとめです。

# 第１章　Web APIとは何か
- この本でいうWeb APIは「HTTPプロトコルを利用してネットワーク越しに呼び出すAPI」
## Web APIを美しく設計する重要性
Web APIを美しく設計した方が良い理由は4つある。
- 使いやすい
- 変更しやすい
- 頑強である
- 恥ずかしくない

### 使いやすい
APIを利用するのは自分ではないケースが多い。設計によって使いやすさが大きく異なってきて、開発期間や開発者のストレスに関わってくる。

### 変更しやすい
Webサービスやシステムはどんどん進化していくため、公開当時と全く同じ状態で２、３年運用が続けられることはない。サービスが変化すれば、そのインターフェースであるAPIも変化を余儀なくされる。
自分たちと関係ない第三者が利用している場合、APIの仕様を大きく変えたことで動かなくなってしまうという事態は避けたい。
特にモバイルアプリケーションの場合、アップデートのタイミングはユーザ次第なので、APIの仕様変更により古いアプリケーションが動かなくなってしまう。
APIを美しく設計することの意味の中には、APIの変化をいかに利用者に影響なく行うか、ということも含まれる。

### 頑強である
APIもWebサイト同様にセキュリティ問題を考慮する必要がある。これに加えてAPIならでは問題もある。こうした問題をきちんと考慮しているAPIが美しいAPIである。

### 恥ずかしくない
Web APIは開発者が目にするもの。コードや設計によって技術レベルを判断されてしまうことがある。美しくないAPIを実装してしまうと、採用等にも影響が出てくる可能性がある。

# 第２章　エンドポイントの設計とリクエストの形式
## APIエンドポイントの考え方
APIで提供する機能を決めたら、エンドポイントを考えながらAPIを整理していく。Web APIにおけるエンドポイントとは、APIにアクセスするためのURIのことを指す。
APIの利用者はこのエンドポイントにアクセスすることで、APIの機能を利用できる。

### エンドポイントの基本的な設計
良い設計とは、「覚えやすく、どんな機能を持つURIなのかがひと目でわかる」ものである。
美しいURIを設計する方法について、一般的に重要な事柄は次の通りです。
- 短く入力しやすいURI：理解しやすく、覚えやすく、入力間違いが少ない。
- 人間が読んで理解できるURI：URIを見ればそれ以外の情報がなくてもそれが何の目的としたものかがある程度わかる。極力省略形は使わないようにする。「この単語はこういう機能、情報を表す」という共通認識があることが多いので、APIでよく利用されている英単語を利用する。
- 大文字小文字が混在していないURI：基本はすべて小文字を使う。大文字小文字の混在は、APIをわかりづらく、間違えやすくする。小文字のエンドポイント対して、大文字でアクセスしてきた場合は、404 NotFoundを返すケースが多くなっている。そもそもHTTPにおいてURIは「スキーマとホスト名を除いては大文字と小文字は区別される」とRFC 7230に書いてある。
- 改造しやすい（Hackableな）URI：URIを修正して別のURIにするのが容易であることを意味する。
- サーバ側のアーキテクチャが反映されていないURI：Webアプリケーションでは、URIがサーバ側のアーキテクチャやディレクトリ構造を反映する必要は全くない。アーキテクチャを特定できるURIにしてしまうと、攻撃されやすくなる。
- ルールが統一されたURI：ルールが統一化されていないとクライアントを実装する場合に混乱を招きやすく、トラブルの温床になる。

## HTTPメソッドとエンドポイント
HTTPメソッドは、HTTPでのアクセス時に指定するもので、GET/POSTなどが有名。URIとメソッドの関係は、操作するものと操作方法の関係である。URIがAPIにおいて、"操作する対象=リソース"を表すものだとすれば、HTTPメソッドは"何をするか"を表すもの。1つのURIのエンドポイントに異なるメソッドでアクセスすることで、情報を取得するだけでなく、情報を変更したり、削除したり様々な操作を行うようにすることで、リソースとそれをどう扱うかをきちんと分離して扱うことができる。
### GETメソッド
情報の取得を表すメソッド。

### POSTメソッド
指定したURIに属する新しいリソースを送信する、つまり新しい情報を登録するために利用するメソッド。

### PUTメソッド
更新したいリソースのURIそのものを指定し、その内容を書き換えるメソッド。また、PUTは送信するデータでもともとのリソースを完全に上書きするというもの。

### DELETEメソッド
リソースの削除を行うメソッド。

### PATCHメソッド
一部を変更することを明示したメソッド。PUTが送信したデータでもともとのリソースを置き換えるものであるのに対し、PATCHではその一部だけを更新したい場合に使う。

## APIのエンドポイント設計
ここの例であげられているエンドポイントは、「/users」と「/users/:id」の2つ。これらはそれぞれ「ユーザの集合」と「個々のユーザ」を表すエンドポイントである。この2つの概念は、データベースで例えるならテーブル名とレコードの関係だと言える。そしてそのテーブルやレコードに対してどんな処理を行うかを表しているのがHTTPメソッド。

エンドポイントを設計する中で注意すべき点
- 複数形の名詞を利用する：名詞の複数形を使って「リソースの集合」を表している。HTTPのURIがそもそもリソースを表すものである考え方からきている。
- 利用する単語を気をつける：利用する単語に困ったら複数のAPIを調べてより多く使われている単語を選択する。
- スペースやエンコードを必要とする文字を使わない：そのエンドポイントがどのようなものかが一目でわからないため、エンドポイントにはパーセントエンコーディングされた文字が入らないようにすべき。
- 単語をつなげる必要がある場合はハイフンを利用する：Webページで場ではリンクアドレスに下線が引かれることが多く、アンダースコアだとこれと重なってしまうため見づらい、アンダースコアは歴史的にタイプライターで下線を引くためのものなので目的にそぐわないといった話がある。
単語をつなげる際、スネークケース、キャメルケース、スパイナルケース（またはチェインケースやケバブケース）で迷った際はスパイナルケースにしておくのが無難。理由は、URI中のホストはハイフンを許可されているが、アンダースコアは使えず、大文字小文字の区別がなく、ドットは特別な意味を持つため、ホスト名と同じルールでURI全体を統一しようとするとハイフンでつなぐのが最も適していることになるからである。

## 検索とクエリパラメータの設計
絞り込みのパラメータを実装すると検索を行うことができる。そのときに利用するのがクエリパラメータ。

### クエリパラメータをパスの使い分け
クエリパラメータに入れるのかパスに入れるのかはURIを設計する上で必要になるが、その判断基準は以下のようにするとよい。
- 一意なリソースを表すのに必要な情報かどうか：ユーザIDを指定することで参照したい情報が一意に決まるのでパスに入れた方がよい。リソースとは関係ないアクセストークンのようなものはクエリパラメータの方が適している。
- 省略可能かどうか：リストや検索の際のoffsetやlimitあるいはpageなどのパラメータは省略すればデフォルトの値が利用されるケースが多くなるため、クエリパラメータの方が適している。
